# Configuration Virtual Host pour Apache (Laragon)
# Fichier: chess.test.conf
# Emplacement: C:\laragon\etc\apache2\sites-enabled\

<VirtualHost *:80>
    # Nom du domaine local
    ServerName chess.test
    ServerAlias *.chess.test
    
    # IMPORTANT: Pointer vers le dossier out/ (et non la racine du projet)
    DocumentRoot "c:/Users/jerom/laragon/www/chess/out"
    
    <Directory "c:/Users/jerom/laragon/www/chess/out">
        # Permissions
        AllowOverride All
        Require all granted
        
        # Headers CORS CRITIQUES pour SharedArrayBuffer (moteurs Stockfish WASM)
        # Sans ces headers, les moteurs d'échecs ne fonctionneront PAS!
        Header set Cross-Origin-Embedder-Policy "require-corp"
        Header set Cross-Origin-Opener-Policy "same-origin"
        
        # Réécriture d'URL pour SPA (Single Page Application)
        RewriteEngine On
        RewriteBase /
        
        # Ne pas réécrire les fichiers qui existent
        RewriteCond %{REQUEST_FILENAME} !-f
        RewriteCond %{REQUEST_FILENAME} !-d
        
        # Rediriger toutes les autres requêtes vers index.html
        RewriteRule . /index.html [L]
    </Directory>
    
    # Cache pour les assets statiques
    <Directory "c:/Users/jerom/laragon/www/chess/out/_next">
        Header set Cache-Control "public, max-age=31536000, immutable"
    </Directory>
    
    # Cache pour les moteurs Stockfish
    <Directory "c:/Users/jerom/laragon/www/chess/out/engines">
        Header set Cross-Origin-Embedder-Policy "require-corp"
        Header set Cross-Origin-Opener-Policy "same-origin"
        Header set Cache-Control "public, max-age=31536000, immutable"
    </Directory>
    
    # Logs (optionnel)
    ErrorLog "c:/laragon/www/chess/logs/error.log"
    CustomLog "c:/laragon/www/chess/logs/access.log" combined
</VirtualHost>

# Instructions d'installation:
# 1. Copier ce fichier dans: C:\laragon\etc\apache2\sites-enabled\chess.test.conf
# 2. Créer le dossier logs: mkdir c:\laragon\www\chess\logs
# 3. Redémarrer Apache via le menu Laragon
# 4. Ouvrir http://chess.test dans votre navigateur
# 5. Vérifier dans la console: console.log(crossOriginIsolated) doit retourner true
